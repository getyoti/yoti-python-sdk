<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share v2 Example</title>
    <script src="https://www.yoti.com/share/client/v2"></script>
    <link rel="stylesheet" type="text/css" href="/static/index.css"/>
     
</head>
<body>
<main>
    <section class="yoti-top-section">
        <div class="yoti-logo-section">
            <img class="yoti-logo-image"
                 src="/static/assets/logo.png"
                 srcset="/static/assets/logo@2x.png 2x"
                 alt="Yoti"/>
        </div>

        <h1 class="yoti-top-header">Digital Identity Share Example</h1>

        <div class="yoti-sdk-integration-section">
            <div id="webshare-target"></div>
        </div>

    </section>

    <section class="yoti-sponsor-app-section">
        <h3 class="yoti-sponsor-app-header">The Yoti app is free to download and use:</h3>

        <div class="yoti-store-buttons-section">
            <a href="https://itunes.apple.com/us/app/yoti/id983980808?ls=1&mt=8" class="yoti-app-button-link">
                <img src="/static/assets/app-store-badge.png"
                     srcset="/static/assets/app-store-badge@2x.png 2x"
                     alt="Download on the App Store"/>
            </a>

            <a href="https://play.google.com/store/apps/details?id=com.yoti.mobile.android.live" class="yoti-app-button-link">
                <img src="/static/assets/google-play-badge.png"
                     srcset="/static/assets/google-play-badge@2x.png 2x"
                     alt="get it on Google Play"/>
            </a>
        </div>
    </section>
</main>

    <script>
        async function onSessionIdResolver() {
            // Make a call to your backend, and return a 'sessionId'
            const response = await fetch('https://localhost:5000/sessions', { method: 'GET' });
            const data = await response.json();
            return data.session_id;
        }

        function onErrorListener(...data) {
            console.warn('onErrorListener:', ...data);
        }

        const loadYoti = async () => {
            const { Yoti } = window;
            if (Yoti) {
                console.info('Waiting for Yoti...');
                await Yoti.ready()
                console.info('Yoti is now ready');
            } else {
                console.error('Yoti client was not found!');
            }
        }

        const createYotiWebShare = async () => {
            const { Yoti } = window;
            if (Yoti) {
                await Yoti.createWebShare({
                    name: 'test-share',
                    domId: 'webshare-target',
                    sdkId: '99525f08-afbb-4420-98b9-0717309f7fed',
                    skinId: 'yoti',
                    flow: 'INLINE_QR',
                    hooks: {
                        sessionIdResolver: onSessionIdResolver,
                        errorListener: onErrorListener
                    }
                })
            }
        }

        const start = async () => {
            await loadYoti();
            await createYotiWebShare();
        }

        start().catch((e) => console.error(`Could not create Yoti WebShare: `, e));
    </script>
</body>

</html>
